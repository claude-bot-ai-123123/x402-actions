# Kora configuration for x402-actions

[kora]
rate_limit = 100

[kora.auth]
# API key for authenticating requests (optional)
# api_key = "x402-dev-key"

# Cache configuration
[kora.cache]
enabled = false
url = "redis://localhost:6379"
default_ttl = 300
account_ttl = 60

# Enable/disable specific RPC methods
[kora.enabled_methods]
liveness = true
estimate_transaction_fee = true
get_supported_tokens = true
sign_transaction = true
sign_and_send_transaction = true
transfer_transaction = true
get_blockhash = true
get_config = true
get_payer_signer = true

[validation]
max_allowed_lamports = 10000000  # 0.01 SOL max
max_signatures = 10
price_source = "Mock"
allow_durable_transactions = false

# Allowed programs for swaps
allowed_programs = [
    "11111111111111111111111111111111",              # System Program
    "TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",   # Token Program
    "ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",  # Associated Token Program
    "AddressLookupTab1e1111111111111111111111111",   # Address Lookup Table Program
    "ComputeBudget111111111111111111111111111111",   # Compute Budget Program
    "TokenzQdBNbLqP5VEhdkAS6EPFLC1PHnBqCXEpPxuEb",   # Token-2022 Program
    "675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8", # Raydium AMM V4
    "CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK", # Raydium CLMM
    "CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C", # Raydium CPMM
    "routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS",  # Raydium Router
    "5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h", # Raydium Authority
]

# Tokens allowed for fee payment
allowed_tokens = [
    "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v", # USDC
]

# Tokens users can pay gas fees with
allowed_spl_paid_tokens = [
    "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v", # USDC
]
disallowed_accounts = []

# Fee payer policy - restrict what fee payer can do
[validation.fee_payer_policy]

[validation.fee_payer_policy.system]
allow_transfer = false          # Don't allow fee payer to send SOL
allow_assign = false            # Don't allow reassigning accounts
allow_create_account = true     # Allow creating accounts (needed for ATAs)
allow_allocate = false

[validation.fee_payer_policy.system.nonce]
allow_initialize = false
allow_advance = false
allow_authorize = false
allow_withdraw = false

[validation.fee_payer_policy.spl_token]
allow_transfer = false          # Don't allow fee payer to transfer tokens
allow_burn = false
allow_close_account = false
allow_approve = false
allow_revoke = false
allow_set_authority = false
allow_mint_to = false
allow_initialize_mint = false
allow_initialize_account = true # Allow initializing token accounts
allow_initialize_multisig = false
allow_freeze_account = false
allow_thaw_account = false

[validation.fee_payer_policy.token_2022]
allow_transfer = false
allow_burn = false
allow_close_account = false
allow_approve = false
allow_revoke = false
allow_set_authority = false
allow_mint_to = false
allow_initialize_mint = false
allow_initialize_account = true
allow_initialize_multisig = false
allow_freeze_account = false
allow_thaw_account = false

[validation.price]
type = "margin"  # Users pay fee + 10% margin
margin = 0.1     # 10% margin on top of actual fee

[validation.token2022]
blocked_mint_extensions = [
    "permanent_delegate",         # Block tokens with permanent delegate
    "transfer_hook",              # Block tokens with transfer hooks
]
blocked_account_extensions = []

[metrics]
enabled = true
endpoint = "/metrics"
port = 8080
scrape_interval = 60

[metrics.fee_payer_balance]
enabled = true
expiry_seconds = 30
